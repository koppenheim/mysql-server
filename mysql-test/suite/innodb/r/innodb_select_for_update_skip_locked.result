CREATE TABLE t1(a INT, b INT NOT NULL, PRIMARY KEY (a)) ENGINE=innodb;
INSERT INTO t1 VALUES (1,1),(2,2),(3,3),(4,4),(5,5),(6,6),(7,7);
CREATE TABLE t2(a INT, b INT NOT NULL, UNIQUE INDEX (a)) ENGINE=innodb;
INSERT INTO t2 VALUES (1,1),(2,2),(3,3),(4,4),(5,5),(6,6),(7,7);
START TRANSACTION;
SELECT * FROM t1 WHERE a < 5 ORDER BY a DESC LIMIT 1 FOR UPDATE;
a	b
4	4
START TRANSACTION;
SELECT * FROM t1 WHERE a < 5 ORDER BY A DESC LIMIT 1 FOR UPDATE SKIP LOCKED;
a	b
3	3
ROLLBACK;
START TRANSACTION;
SELECT * FROM t2 WHERE a > 4 LIMIT 1 FOR UPDATE;
a	b
5	5
START TRANSACTION;
SELECT * FROM t2 WHERE a > 4 LIMIT 1 FOR UPDATE SKIP LOCKED;
a	b
6	6
ROLLBACK;
DROP TABLE t1;
DROP TABLE t2;
